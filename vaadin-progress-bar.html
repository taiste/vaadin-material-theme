<link rel="import" href="color.html">

<link rel="import" href="../vaadin-progress-bar/src/vaadin-progress-bar.html">

<dom-module id="material-progress-bar" theme-for="vaadin-progress-bar">
  <template>
    <style>
      :host {
        height: 4px;
        margin: 8px 0;
      }

      [part="bar"] {
        border-radius: 4px;
        background-color: var(--material-divider-color);
      }

      [part="value"] {
        border-radius: 4px;
        background-color: var(--material-primary-color);
        /* Use width instead of transform to preserve border radius */
        transform: none;
        width: calc(var(--vaadin-progress-value) * 100%);
        min-width: 0.25em;
        will-change: width;
        transition: 0.2s width;
      }

      /* Indeterminate mode */

      :host([indeterminate]) [part="value"] {
        --material-progress-indeterminate-progress-bar-background: var(--material-primary-color);
        width: 30%;
        height: 4px;
        background-color: var(--material-progress-indeterminate-progress-bar-background);
        overflow: hidden;
        will-change: transform;
        animation: running-progress 2s linear infinite;
      }

      @-webkit-keyframes running-progress {
        0% { margin-left: 0%; margin-right: 100%; width: 0%;}
        30% { margin-left: 0%; margin-right: 70%; width: 30%;}
        70% { margin-left: 70%; margin-right: 0%; width: 30%; }
        100% { margin-left: 100%; margin-right: 0; width: 0%; }
      }
      @keyframes running-progress {
        0% { margin-left: 0%; margin-right: 100%; width: 0%;}
        30% { margin-left: 0%; margin-right: 70%; width: 30%;}
        70% { margin-left: 70%; margin-right: 0%; width: 30%; }
        100% { margin-left: 100%; margin-right: 0; width: 0%; }
      }

      /* Error color */

      :host([theme~="error"]) [part="value"],
      :host([theme~="error"]) [part="value"]::before {
        background-color: var(--material-error-color);
        --material-progress-indeterminate-progress-bar-background: var(--material-error-color);
      }

    </style>
  </template>
</dom-module>

<!-- Safari fails to declare animations for pseudo elements inside a shadow DOM -->
<custom-style>
  <style>
    @keyframes vaadin-progress-pulse3 {
      0% { opacity: 1; }
      10% { opacity: 0; }
      40% { opacity: 0; }
      50% { opacity: 1; }
      50.1% { opacity: 1; }
      60% { opacity: 0; }
      90% { opacity: 0; }
      100% { opacity: 1; }
    }
  </style>
</custom-style>
